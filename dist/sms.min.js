!function(){angular.module("ysSmsVerification.config",[]).value("ysSmsVerification.config",{debug:!0}),angular.module("internationalPhoneNumber",[]).directive("internationalPhoneNumber",function(){return{restrict:"A",require:"^ngModel",link:function(scope,element,attrs,ctrl){var handleWhatsSupposedToBeAnArray,options,read;return read=function(){return ctrl.$setViewValue(element.val())},handleWhatsSupposedToBeAnArray=function(e){return"object"==typeof e?e:e.toString().replace(/[ ]/g,"").split(",")},options={autoFormat:!0,autoHideDialCode:!0,defaultCountry:"",nationalMode:!1,numberType:"",onlyCountries:void 0,preferredCountries:["us","gb"],responsiveDropdown:!1,utilsScript:""},angular.forEach(options,function(value,key){var option;return option=eval("attrs."+key),angular.isDefined(option)?"preferredCountries"===key?options.preferredCountries=handleWhatsSupposedToBeAnArray(option):"onlyCountries"===key?options.onlyCountries=handleWhatsSupposedToBeAnArray(option):options[key]="boolean"==typeof value?"true"===option:option:void 0}),element.intlTelInput(options),scope.country=element.intlTelInput("getSelectedCountryData"),options.utilsScript||element.intlTelInput("loadUtils","bower_components/intl-tel-input/lib/libphonenumber/build/utils.js"),ctrl.$parsers.push(function(e){return e?e.replace(/[^\d]/g,""):e}),ctrl.$parsers.push(function(e){return e?ctrl.$setValidity("international-phone-number",element.intlTelInput("isValidNumber")):(e="",delete ctrl.$error["international-phone-number"]),e}),element.on("blur keyup change",function(){return scope.$apply(read)}),element.on("$destroy",function(){return element.off("blur keyup change")})}}}),angular.module("ysSmsVerification.directives",[]),angular.module("ysSmsVerification.filters",[]),angular.module("ysSmsVerification.services",[]),angular.module("ysSmsVerification.templates",[]),angular.module("ysSmsVerification",["ysSmsVerification.config","ysSmsVerification.directives","ysSmsVerification.filters","ysSmsVerification.services","ysSmsVerification.templates","ngSanitize","internationalPhoneNumber","timer"]),angular.module("ysSmsVerification.templates").run(["$templateCache",function(e){e.put("mobile-number.html",'<form class="form-horizontal" name="mobileNumberForm" >\n\n    <div class="form-group form-group-lg has-feedback">\n        <label for="inputEmail3" class="col-sm-3 control-label">{{ \'phone_number\' | translate }}</label>\n        <div class="col-sm-5">\n\n            <div ng-if="fail" class="alert alert-danger text-center">\n                {{ \'something_went_wrong\' | translate }}\n            </div>\n\n            <div class="form-group form-group-lg has-feedback">\n                <div class="col-sm-12">\n                    <input class=\'form-control input-lg\' type="text" utils-script="{{ utilsScript }}" \n                    preferred-countries="ps, sa,jo,kw,qa,bh,uae,"\n                     responsive-dropdown=\'true\' default-country="ps" international-phone-number name="phoneNumber" ng-model="phoneNumber" ng-required="true" />\n                    <span style="top:15px;right: 21px;" ng-show="mobileNumberForm.phoneNumber.$valid" class="fa fa-check-circle text-success form-control-feedback" aria-hidden="true"></span>\n                </div>\n            </div>\n            <div class="form-group form-group-lg">\n                <div class="col-sm-12">\n                    <button ng-disabled="submittingPhone" type=\'buttom\' ng-click="submitNumber(phoneNumber)" class=\'btn btn-primary btn-block btn-lg\'>\n                        <span> {{ \'send_me_sms\' | translate }} </span>\n                        <span ng-if="submittingPhone"> <i class="fa fa-spinner fa-spin"></i> \n                        </span>\n                    </button>\n                </div>\n            </div>\n        </div>\n        <div class="col-sm-4">\n            <p class="help-block">\n                <strong>{{ \'send_you_verification\' | translate }}</strong>\n                <br />{{ \'code_to_confirm\' | translate }}</p>\n        </div>\n    </div>\n</form>\n'),e.put("sms-verification.html","\n<mobile-number>\n</mobile-number>\n\n<verification-code>\n</verification-code>\n\n<verification-success>\n</verification-success>\n"),e.put("verification-code.html",'<form class="form-horizontal" name="verificationCodeForm" >\n    <div class="form-group form-group-lg">\n        <label for="inputEmail3" class="col-sm-3 control-label">{{ \'verification_code\' | translate }}</label>\n        <div class="col-sm-5">\n            <div class="form-group form-group-lg has-feedback" show-errors>\n                <div class="col-sm-12">\n                    <div class="input-group">\n                        <input id="verification-code" class=\'form-control\' type=\'text\' name="code" ng-model=\'code\' ng-minlength="5" ng-maxlength="7" ng-required=\'true\' placeholder=\'_______ \' style="font-size: 30px;height: 70px;letter-spacing: 7px;font-family: monospace;text-align: center; color:black; " />\n                        <span class="input-group-btn">\n                            <a class="btn btn-default" type="button" style="padding: 14px 24px;font-size: 28px;color:black;" disabled><i class="fa fa-lock"></i>\n                            </a>\n                        </span>\n                    </div>\n                </div>\n            </div>\n            <div class="row">\n                <div class="col-md-12">\n                    <button type="button" ng-click=\'submitCode(code)\' class="btn btn-block book-btn-2 has-label" ng-disabled="booking">\n                        <span class="the-label">\n                            <i class="fa fa-{{ booking ? \'spin fa-spinner\' : \'lock\' }}"></i>\n                        </span>\n                        <span>{{ \'complete_booking\' | translate }}</span>\n                    </button>\n                </div>\n            </div>\n        </div>\n        <div class="col-sm-4">\n        \n            <div ng-if="!error">\n                <p class="help-block" ng-if="!error">\n                    {{ \'code_being_delivered\' | translate }}\n                    <br>{{ \'minutes_note\' | translate }}\n                    <br>\n                    <strong>\n                    <small>\n                        <timer autostart="false" countdown="5" max-time-unit="\'minute\'" interval="1000" finish-callback="timerFinished()">\n                        {{mminutes}} {{ \'minute\' | translate  }} {{minutesS}}, {{sseconds}} {{ \'second\' | translate }} {{secondsS}}</timer> <i class="fa fa-clock-o"></i> {{ \'passed\' | translate }}.\n                    </small>\n                </strong>\n                    <span class="text-center" ng-show="timeout">\n                    {{ \'did_not_receive_code\' | translate }} <br> <a ng-click="tryAgain()" href=""> {{ \'try_different_number\' | translate }} </a>\n                </span>\n                </p>\n            </div>\n\n            <div ng-if="error">\n                <p class="help-block text-danger">\n                    <strong>\n                         <i class="fa fa-warning fa-2x pull-left"></i> {{ error.message }}\n                         <hr>\n                         {{ \'did_not_receive_code\' | translate }} <a ng-click="tryAgain()" href="">{{ \'try_different_number\' | translate }} </a>\n                    </strong>\n                </p>\n            </div>\n\n        </div>\n    </div>\n</form>\n')}]);var Deez=angular.module("ysSmsVerification.directives",[]);Deez.directive("ysSmsVerification",["$templateCache","$compile",function(e,n){return{link:function(){},controller:function(e){var n=this;e.smsVerificationData={phoneNumber:null,country_code:null,code:null},this.screens={},this.addScreen=function(e,t){n.screens[e]=t},this.activateScreen=function(e){return n.screens[e]?(angular.forEach(n.screens,function(e){e.active=!1}),n.screens[e].active=!0,void 0):0},e.$on("mobileNumber:success",function(){n.activateScreen("verificationCode"),e.$broadcast("timer-start")}),e.$on("verificationCode:success",function(n,t){e.$emit("smsVerification:success",t),e.smsVerificationData=t}),e.$on("verificationCode:tryagain",function(){n.activateScreen("mobileNumber")})},link:function(t,i,r){var o=r.templateUrl?e.get(r.templateUrl):e.get("sms-verification.html");i.html(o),n(i.contents())(t)},scope:!0,transclude:!0}}]),Deez.directive("mobileNumber",["$templateCache","$compile",function(e,n){return{restrict:"EA",require:"^ysSmsVerification",controller:function(e,n,t,i){e.active=!0,e.utilsScript=Yamsafer.urls.utilsScriptPath,console.log(e.utilsScript),e.submitNumber=function(){if(e.mobileNumberForm.$valid){e.submittingPhone=!0;var n={};n.country_code="+"+$('input[name="phoneNumber"]').intlTelInput("getSelectedCountryData").dialCode,n.phone_number=e.mobileNumberForm.phoneNumber.$viewValue.replace(n.country_code,"").replace(/\s+/g,""),i.send(n).then(function(t){"error"!=t.status&&(i.dataAttr("phone_number",n.phone_number),i.dataAttr("country_code",n.country_code),e.$emit("mobileNumber:success",n)),e.submittingPhone=!1},function(){e.fail=!0,e.$emit("mobileNumber:fail")})}}},scope:!0,link:function(t,i,r,o){var s=r.templateUrl?e.get(r.templateUrl):e.get("mobile-number.html");s='<div ng-show="active"> '+s+" </div>",i.html(s),n(i.contents())(t),o.addScreen("mobileNumber",t)},transclude:!0}}]),Deez.directive("verificationCode",["$templateCache","$compile",function(e,n){return{restrict:"EA",require:"^ysSmsVerification",scope:!0,transclude:!0,controller:function(e,n,t,i){e.submitCode=function(n){e.$emit("verificationCode:submitting",function(t){if(console.log(t),t.success){var r=e.verificationCodeForm.$valid;if(r){e.booking=!0;var o={phone_number:i.dataAttr("phone_number"),country_code:i.dataAttr("country_code"),code:n},s=function(n){"verification failed"!=n.status?e.$emit("verificationCode:success",o):(e.error=n,e.booking=!1)},a=function(n){e.error=n,e.booking=!1};i.verify(o).then(s,a)}}else $("#verification-code").focus()})},e.timerFinished=function(){e.timeout=!0,e.$emit("verificationCode:timeout",e),e.$apply()},e.tryAgain=function(){e.error=!1,e.timeout=!1,e.$emit("verificationCode:tryagain")}},link:function(t,i,r,o){var s=r.templateUrl?e.get(r.templateUrl):e.get("verification-code.html");s='<div ng-show="active"> '+s+" </div>",i.html(s),n(i.contents())(t),o.addScreen("verificationCode",t)}}}]),Deez.directive("verificationSuccess",["$templateCache","$compile",function(e,n){return{restrict:"EA",require:"^ysSmsVerification",scope:{},transclude:!0,link:function(t,i,r,o){var s=r.templateUrl?e.get(r.templateUrl):e.get("verification-success.html");s='<div ng-show="active"> '+s+" </div>",i.html(s),n(i.contents())(t),o.addScreen("verificationSuccess",t)}}}]),angular.module("ysSmsVerification.services",[]).service("smsService",["$q","$http","$timeout",function(e,n){var t={},i={phone_number:null,country_code:null,code:null};return t.dataAttr=function(e,n){return n?(i[e]=n,void 0):i[e]},t.send=function(t){console.log(t);var i=e.defer();return n.post("https://staging.yamsafer.me/sms/create",t).success(function(e){i.resolve(e)}).error(function(e){i.reject(e)}),i.promise},t.verify=function(t){var i=e.defer();return n.post("https://staging.yamsafer.me/sms/verify",t).success(function(e,n){200==n&&i.resolve(e),(400==n.code||500==n.code)&&i.reject(e)}).error(function(e){i.reject(e)}),i.promise},t}])}();