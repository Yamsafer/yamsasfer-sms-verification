!function(){angular.module("ysSmsVerification.config",[]).value("ysSmsVerification.config",{debug:!0}),angular.module("internationalPhoneNumber",[]).directive("internationalPhoneNumber",function(){return{restrict:"A",require:"^ngModel",link:function(scope,element,attrs,ctrl){var handleWhatsSupposedToBeAnArray,options,read;return read=function(){return ctrl.$setViewValue(element.val())},handleWhatsSupposedToBeAnArray=function(e){return"object"==typeof e?e:e.toString().replace(/[ ]/g,"").split(",")},options={autoFormat:!0,autoHideDialCode:!0,defaultCountry:"",nationalMode:!1,numberType:"",onlyCountries:void 0,preferredCountries:["us","gb"],responsiveDropdown:!1,utilsScript:""},angular.forEach(options,function(value,key){var option;return option=eval("attrs."+key),angular.isDefined(option)?"preferredCountries"===key?options.preferredCountries=handleWhatsSupposedToBeAnArray(option):"onlyCountries"===key?options.onlyCountries=handleWhatsSupposedToBeAnArray(option):options[key]="boolean"==typeof value?"true"===option:option:void 0}),element.intlTelInput(options),scope.country=element.intlTelInput("getSelectedCountryData"),options.utilsScript||element.intlTelInput("loadUtils","bower_components/intl-tel-input/lib/libphonenumber/build/utils.js"),ctrl.$parsers.push(function(e){return e?e.replace(/[^\d]/g,""):e}),ctrl.$parsers.push(function(e){return e?ctrl.$setValidity("international-phone-number",element.intlTelInput("isValidNumber")):(e="",delete ctrl.$error["international-phone-number"]),e}),element.on("blur keyup change",function(){return scope.$apply(read)}),element.on("$destroy",function(){return element.off("blur keyup change")})}}}),angular.module("ysSmsVerification.directives",[]),angular.module("ysSmsVerification.filters",[]),angular.module("ysSmsVerification.services",[]),angular.module("ysSmsVerification.templates",[]),angular.module("ysSmsVerification",["ysSmsVerification.config","ysSmsVerification.directives","ysSmsVerification.filters","ysSmsVerification.services","ysSmsVerification.templates","ngSanitize","internationalPhoneNumber","timer"]),angular.module("ysSmsVerification.templates").run(["$templateCache",function(e){e.put("mobile-number.html",'<form class="form-horizontal" name="mobileNumberForm" ng-submit=\'submitNumber(phoneNumber)\'>\n\n    <div class="form-group form-group-lg">\n        <label for="inputEmail3" class="col-sm-3 control-label">Phone Number</label>\n        <div class="col-sm-5">\n\n            <div ng-if="fail" class="alert alert-danger text-center">\n                Something went wrong, make sure you entered a valid phone number, or try a different one\n            </div>\n\n            <div class="form-group form-group-lg">\n                <div class="col-sm-12">\n                    <input class=\'form-control input-lg\' type="text" preferred-countries="ps, sa,jo,kw" responsive-dropdown=\'true\' default-country="ps" international-phone-number name="phoneNumber" ng-model="phoneNumber" ng-required="true" />\n                </div>\n            </div>\n            <div class="form-group form-group-lg">\n                <div class="col-sm-12">\n                    <button ng-disabled="submittingPhone" type=\'submit\' class=\'btn btn-primary btn-block btn-lg\'>Send Me SMS\n                        <span ng-if="submittingPhone"> <i class="fa fa-spinner fa-spin"></i> \n                        </span>\n                    </button>\n                </div>\n            </div>\n        </div>\n        <div class="col-sm-4">\n            <p class="help-block">\n                <strong>We will send you a verification code by SMS.</strong>\n                <br />You will need this code to confirm your booking.</p>\n        </div>\n    </div>\n</form>\n'),e.put("sms-verification.html","\n<mobile-number>\n</mobile-number>\n\n<verification-code>\n</verification-code>\n\n\n<verification-success>\n</verification-success>\n"),e.put("verification-code.html",'<form class="form-horizontal" name="verificationCodeForm" ng-submit=\'submitCode(code)\'>\n    <div class="form-group form-group-lg">\n        <label for="inputEmail3" class="col-sm-3 control-label">Verfication Code</label>\n        <div class="col-sm-5">\n            <div class="form-group form-group-lg">\n                <div class="col-sm-12">\n                    <div class="input-group">\n                        <input class=\'form-control\' type=\'text\' name="code" ng-model=\'code\' ng-minlength="5" ng-maxlength="7" ng-required=\'true\' placeholder=\'_______ \' \n                        style="font-size: 30px;height: 70px;letter-spacing: 7px;font-family: monospace;text-align: center; color:black; " />\n                        <span class="input-group-btn">\n                            <a class="btn btn-default" type="button" style="padding: 14px 24px;font-size: 28px;color:black;" disabled><i class="fa fa-lock"></i>\n                            </a>\n                        </span>\n                    </div>\n                </div>\n            </div>\n            <div class=\'form-group form-group-lg\'>\n                <div class="col-sm-12">\n                    <button type=\'submit\' class=\'btn btn-primary btn-block btn-lg\'>Complete Booking</button>\n                </div>\n            </div>\n        </div>\n        <div class="col-sm-4">\n            <p class="help-block">\n                Your code is being delivered by SMS.\n                <br>This may take up to 2:30 minutes depending on your network operator.\n                <br>\n                <strong>\n                    <small>\n                        <timer autostart="false" countdown="5" max-time-unit="\'minute\'" interval="1000" finish-callback="timerFinished()">{{mminutes}} minute{{minutesS}}, {{sseconds}} second{{secondsS}}</timer> <i class="fa fa-clock-o"></i> passed.\n                    </small>\n                </strong>\n\n                <span class="text-center" ng-show="timeout">\n                    Didn\'t receive code ? <a ng-click="tryAgain()" href="">Try a different number</a>\n                </span>\n            </p>\n        </div>\n    </div>\n</form>')}]);var Deez=angular.module("ysSmsVerification.directives",[]);Deez.directive("ysSmsVerification",["$templateCache","$compile",function(e,n){return{link:function(){},controller:function(e){var n=this;e.smsVerificationData={phoneNumber:null,country_code:null,code:null},this.screens={},this.addScreen=function(e,t){n.screens[e]=t},this.activateScreen=function(e){return n.screens[e]?(angular.forEach(n.screens,function(e){e.active=!1}),n.screens[e].active=!0,void 0):0},e.$on("mobileNumber:success",function(){n.activateScreen("verificationCode"),e.$broadcast("timer-start")}),e.$on("verificationCode:success",function(t,i){e.$emit("smsVerification:success",i),e.smsVerificationData=i,n.activateScreen("verificationSuccess")}),e.$on("verificationCode:tryagain",function(){n.activateScreen("mobileNumber")})},link:function(t,i,o){var r=o.templateUrl?e.get(o.templateUrl):e.get("sms-verification.html");i.html(r),n(i.contents())(t)},scope:!0,transclude:!0}}]),Deez.directive("mobileNumber",["$templateCache","$compile",function(e,n){return{restrict:"EA",require:"^ysSmsVerification",controller:function(e,n,t,i){e.active=!0,e.submitNumber=function(){if(e.mobileNumberForm.$valid){var n={};n.country_code="+"+$('input[name="phoneNumber"]').intlTelInput("getSelectedCountryData").dialCode,n.phone_number=e.mobileNumberForm.phoneNumber.$viewValue.replace(n.country_code,"").replace(/\s+/g,""),e.submittingPhone=!0;var t=function(t){"error"!=t.status&&(i.dataAttr("phone_number",n.phone_number),i.dataAttr("country_code",n.country_code),e.$emit("mobileNumber:success",n)),e.submittingPhone=!1},o=function(){e.fail=!0,e.$emit("mobileNumber:fail")};i.send(n).then(t,o)}}},scope:!0,link:function(t,i,o,r){var s=o.templateUrl?e.get(o.templateUrl):e.get("mobile-number.html");s='<div ng-show="active"> '+s+" </div>",i.html(s),n(i.contents())(t),r.addScreen("mobileNumber",t)},transclude:!0}}]),Deez.directive("verificationCode",["$templateCache","$compile",function(e,n){return{restrict:"EA",require:"^ysSmsVerification",scope:{},transclude:!0,controller:function(e,n,t,i){e.submitCode=function(n){var t=e.verificationCodeForm.$valid;if(t){var o={phone_number:i.dataAttr("phone_number"),country_code:i.dataAttr("country_code"),code:n},r=function(n){"verification failed"!=n.status?e.$emit("verificationCode:success",o):console.log(n.message)},s=function(e){console.log(e.error,e.message)};console.log(o),i.verify(o).then(r,s)}},e.timerFinished=function(){e.timeout=!0,e.$emit("verificationCode:timeout",e),e.$apply()},e.tryAgain=function(){e.timeout=!1,e.$emit("verificationCode:tryagain")}},link:function(t,i,o,r){var s=o.templateUrl?e.get(o.templateUrl):e.get("verification-code.html");s='<div ng-show="active"> '+s+" </div>",i.html(s),n(i.contents())(t),r.addScreen("verificationCode",t)}}}]),Deez.directive("verificationSuccess",["$templateCache","$compile",function(e,n){return{restrict:"EA",require:"^ysSmsVerification",scope:{},transclude:!0,link:function(t,i,o,r){var s=o.templateUrl?e.get(o.templateUrl):e.get("verification-success.html");s='<div ng-show="active"> '+s+" </div>",i.html(s),n(i.contents())(t),r.addScreen("verificationSuccess",t)}}}]),angular.module("ysSmsVerification.services",[]).service("smsService",["$q","$http","$timeout",function(e,n){var t={},i={phone_number:null,country_code:null,code:null};return t.dataAttr=function(e,n){return n?(i[e]=n,void 0):i[e]},t.send=function(t){console.log(t);var i=e.defer();return n.post("https://staging.yamsafer.me/sms/create",t).success(function(e){i.resolve(e)}).error(function(e){i.reject(e)}),i.promise},t.verify=function(t){var i=e.defer();return n.post("https://staging.yamsafer.me/sms/verify",t).success(function(e,n){200==n&&i.resolve(e),(400==n.code||500==n.code)&&i.reject(e)}).error(function(e){i.reject(e)}),i.promise},t}])}();